<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>script.aculo.us Unit test file</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <script src="../../lib/prototype.js" type="text/javascript"></script>
  <script src="../../src/util.js" type="text/javascript"></script>
  <script src="../../src/unittest.js" type="text/javascript"></script>
  <script src="../../src/effects.js" type="text/javascript"></script>
  <script src="../../src/dragdrop.js" type="text/javascript"></script>
  <script src="../../src/controls.js" type="text/javascript"></script>
  <link rel="stylesheet" href="../test.css" type="text/css" />
  <style>
    .selected { background-color: #888; }
  </style>
</head>
<body>
<h1>script.aculo.us Unit test file</h1>
<p>
  Tests for the Ajax.Autocompleter.
</p>

<!-- Log output -->
<div id="testlog"> </div>

<input id="ac_input" type="text" autocomplete="off" />
<div id="ac_update" style="display:none;border:1px solid black;background-color:white;position:relative;"></div>

<input id="dummy_element" type="text" autocomplete="off" />

<!-- Tests follow -->
<script type="text/javascript" language="javascript" charset="utf-8">
// <![CDATA[

  new Test.Unit.Runner({

    // Integration test, tests the entire cycle
    testAjaxAutocompleter: function() { with(this) {
      var ac = new Ajax.Autocompleter('ac_input','ac_update','_autocomplete_result.html');
      assertInstanceOf(Ajax.Autocompleter, ac);
      
      // box not visible
      assertNotVisible('ac_update');
      
      // focus, but box not visible
      Event.simulateMouse('ac_input', 'click');
      assertNotVisible('ac_update');
      
      Event.simulateKeys('ac_input','abcdefg');
      assertEqual('abcdefg', $('ac_input').value);
      
      // check box popping up on input
      wait(1000, function() { with(this) {
        assertVisible('ac_update');
        assertEqual('test1', $('ac_update').firstChild.firstChild.innerHTML);
        assertEqual('test2', $('ac_update').firstChild.firstChild.nextSibling.innerHTML);
        
        // first entry should be selected
        assert(Element.Class.has($('ac_update').firstChild.firstChild),'selected');
        
        Event.simulateKey('ac_input','keypress',{keyCode:Event.KEY_DOWN});
        
        // second entry should be selected
        assert(!Element.Class.has($('ac_update').firstChild.firstChild),'selected');
        assert(Element.Class.has($('ac_update').firstChild.firstChild.nextSibling),'selected');
        
        // check selecting with <TAB>
        Event.simulateKey('ac_input','keypress',{keyCode:Event.KEY_TAB});
        assertEqual('test2',$('ac_input').value);
        
        // check box going away
        wait(500, function() { with(this) {
          assertNotVisible('ac_update');
          
          // check selecting with mouse click
          Event.simulateKeys('ac_input','3');
          assertEqual('test23', $('ac_input').value);
          wait(1000, function() { with(this)
            assertVisible('ac_update');
            Event.simulateMouse($('ac_update').firstChild.firstChild,'click');
                    
            wait(1000, function() { with(this)
              assertEqual('test1',$('ac_input').value);
              assertNotVisible('ac_update');
            });
          });
        }});
      }});
    }},

  });
// ]]>
</script>
</body>
</html>